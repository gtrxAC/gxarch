; Convert cursor position to memory address
; arg0 = x
; arg1 = ch
; arg2 = y
; arg3 = page
; return value arg4 arg5
pos2addr: {
	reg x arg0
	reg ch arg1
	reg y arg2
	reg page arg3

	reg resh arg4
	reg resl arg5

	set resh hi(SRAM)
	set resl lo(SRAM)

	add resh page resh

	mul y (%0:LINE_LENGTH) %1
	add resh %h resh
	add resl %1 resl

	mul ch (%0:CHANNEL_LENGTH) %1
	add resh %h resh
	add resl %1 resl

	add resl x resl
	add resh %h resh
	ret
}